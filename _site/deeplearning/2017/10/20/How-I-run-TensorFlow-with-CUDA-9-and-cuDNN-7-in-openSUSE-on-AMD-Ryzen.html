<!DOCTYPE html>
<html>
  <head>
    
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="shortcut icon" href="/static/img/favicon.ico" />
        <title>How I run TensorFlow with CUDA 9 and cuDNN 7 in openSUSE on Ryzen - Computer Vision Lab</title>
        <meta name="author" content="Manuel Carita" />
        <meta name="description" content="How I run TensorFlow with CUDA 9 and cuDNN 7 in openSUSE on Ryzen" />
        <meta name="keywords" content="How I run TensorFlow with CUDA 9 and cuDNN 7 in openSUSE on Ryzen, Computer Vision Lab, DeepLearning" />

        <meta content="" property="fb:app_id">
        <meta content="Computer Vision Lab" property="og:site_name">
        
          <meta content="How I run TensorFlow with CUDA 9 and cuDNN 7 in openSUSE on Ryzen" property="og:title">
        
        
          <meta content="article" property="og:type">
        
        
          <meta content="A Robotics, Computer Vision and Machine Learning lab by Manuel Carita. The main focus of the blog is Self-Driving Car Technology and Deep Learning.
" property="og:description">
        
        
          <meta content="http://localhost:4000/deeplearning/2017/10/20/How-I-run-TensorFlow-with-CUDA-9-and-cuDNN-7-in-openSUSE-on-AMD-Ryzen.html" property="og:url">
        
        
          <meta content="2017-10-20T04:00:00-05:00" property="article:published_time">
          <meta content="http://localhost:4000/about/" property="article:author">
        
        
          <meta content="http://localhost:4000/static/img/logo-high-resolution.png" property="og:image">
        
        
          
          <meta content="DeepLearning" property="article:section">
          
        
        
          
        
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@">
        <meta name="twitter:creator" content="@">
        
          <meta name="twitter:title" content="How I run TensorFlow with CUDA 9 and cuDNN 7 in openSUSE on Ryzen">
        
        
          <meta name="twitter:url" content="http://localhost:4000/deeplearning/2017/10/20/How-I-run-TensorFlow-with-CUDA-9-and-cuDNN-7-in-openSUSE-on-AMD-Ryzen.html">
        
        
          <meta name="twitter:description" content="A Robotics, Computer Vision and Machine Learning lab by Manuel Carita. The main focus of the blog is Self-Driving Car Technology and Deep Learning.
">
        
        

      <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">
      <script type="text/javascript">window.baseurl = 'http://localhost:4000';</script>
      
        <!-- Custom Fonts -->
        <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">

        <!-- FontAwesome icons -->
        <link rel="stylesheet" href="https://use.fontawesome.com/74dfc6cf47.css">

        <!-- Core BootStrap CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <!-- Material Design CSS -->
        <link rel="stylesheet" href="/static/css/bootstrap-material-design.min.css">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/static/css/syntax.css">

        <!-- Custom CSS -->        
        <link rel="stylesheet" href="/static/css/thickbox.css">
        <link rel="stylesheet" href="/static/css/main.css">
        <link rel="stylesheet" href="/static/css/projects.css">

        <script type="text/javascript">
          //loadingImage is relative to project dir
          var tb_pathToImage = "/static/img/loadingAnimation.gif";
        </script>

  </head>

  <body class="home overflow-hidden">
    <div class="header-panel shadow-z-2">
      <div class="container">
        <div class="row">
          <div class="col-md-5 col-sm-5 col-xs-12">
            <div class="row-picture">
              <img id="about" class="logo-img" src="/static/img/logo.png" height="75px" width="75px">
            </div>
            <div class="row-details">
              <h3 class="list-group-item-heading" style="padding-top: 15%;font-size: 32px">Manuel Carita</h3>
              <h5 class="list-group-item-heading">Mechatronics Engineer</h5>
              <div class="social-icons">
	
        <a class="icon" target="_blank" href="https://www.linkedin.com/in/manuelcarita"><i class="fa fa-linkedin"></i></a>
    
        <a class="icon" target="_blank" href="https://github.com/manul30"><i class="fa fa-github"></i></a>
    
</div>

            </div>
            <div class="navbar-header pull-right">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <i class="fa fa-2x fa-bars"></i>
              </button>
            </div>
          </div>
          <div class="col-md-7 col-sm-7 col-xs-12">
          <div class="row">
            <h2 class="blog-title-pro " style="padding-top: 5%;padding-left: 40%;font-size: 24px;">How I run TensorFlow with CUDA 9 and cuDNN 7 in openSUSE on Ryzen</h2>
            
            </div>
            <p class="info">
              
                <span class="time">20 Oct 2017</span>
              
              
                <span class="categories">
                  &raquo; 
                  
                    <a href="/category/DeepLearning">DeepLearning</a>
                    
                  
                </span>
              
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="container main outer">
      <div class="row">
        <div class="col-md-3 col-xs-12">
              <nav class="menu">
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="list-separator nav navbar-nav well well-primary post">

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12 current-menu-item How-I-run-TensorFlow-with-CUDA-9-and-cuDNN-7-in-openSUSE-on-AMD-Ryzen.html"><a href="/" target="_self"><i class="fa fa-home"></i> Home</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  How-I-run-TensorFlow-with-CUDA-9-and-cuDNN-7-in-openSUSE-on-AMD-Ryzen.html"><a href="/projects" target="_self"><i class="fa fa-desktop"></i> Projects</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  How-I-run-TensorFlow-with-CUDA-9-and-cuDNN-7-in-openSUSE-on-AMD-Ryzen.html"><a href="/about" target="_self"><i class="fa fa-user"></i> About me</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  How-I-run-TensorFlow-with-CUDA-9-and-cuDNN-7-in-openSUSE-on-AMD-Ryzen.html"><a href="/resume" target="_self"><i class="fa fa-graduation-cap"></i> Profile</a></li>

</ul>

    </div>
    </nav>

        </div>
        <div class="col-md-9 col-xs-12 full">
          <div class="post-content well">
<article class="content">
    <div class="post-head">
    <h1><b>How I run TensorFlow with CUDA 9 and cuDNN 7 in openSUSE on Ryzen </b></h1>
    </div>
    <p>October 20, 2017</p>
    <p>

  4 mins read

</p>
    <div class="post"><h2 id="introduction">Introduction</h2>

<p>I was faced with the necessity of computational power increase in order to meet my needs in computer vision research. As for me, AMD Ryzen CPU’s provide the best value/cost ratio on the market at the given time. That is why I built my new PC on the platform. However, the path of software installation for deep learning is not straightforward, so, here it is a set of instructions I followed to start TensorFlow 1.4 on Nvidia GPUs with the latest CUDA 9 and cuDNN 7.0.</p>

<p>Generally speaking, every step is quite simple, however, it is challenging to select appropriate versions of software to make the whole system run. The versions compatibility is the main focus of the post.</p>

<p><em>I cannot guarantee your results, so, do it voluntarily, with deep understanding what you do and at your own risk.</em></p>

<p>UPDATE: Some of the provided instructions are redundant since TensorFlow 1.5 with CUDA 9 support can be simply installed by <code class="highlighter-rouge">pip install tensorflow-gpu</code>.
However, one may use the article as a reference for TensorFlow build from source for obtaining the most recent version or processor-specific optimization.</p>

<h2 id="hardware">Hardware</h2>

<ul>
  <li>AMD Ryzen 7 1700X</li>
  <li>ASUS X370-PRO Motherboard</li>
  <li>Nvidia GPU</li>
</ul>

<h2 id="right-after-assembly">Right after assembly</h2>

<p>My motherboard was shipped with outdated BIOS. I had to install the latest one from the official site of the motherboard vendor.
It is preferred to install a version with AGESA 1.0.0.6b as it can <a href="https://www.phoronix.com/scan.php?page=news_item&amp;px=AGESA-1.0.0.6b-Update">resolve</a> some Ryzen issues.</p>

<p>The motherboard was unable to correctly set default CPU and RAM voltage (it was too high for the processor and too low for memory in my case which causes some issues with the system boot). So, I had to check and set them manually to the values recommended by the parts manufacturer.</p>

<h2 id="install-opensuse">Install openSUSE</h2>

<p>There are a great variety of operating system distros, so everyone can choose one to meet own tastes. As for me, openSUSE is a good option because of its stability.</p>

<p>It is possible to simply install the OS with an .iso image from <a href="https://software.opensuse.org/">openSUSE</a> official site. We have to use Leap 42.2 version as it the only version supported by proprietary precompiled CUDA 9.
One can follow GUI instructions during the installation process. In the partitioner, I prefer to use LVM for future flexibility.</p>

<p>After the OS installation, one has to upgrade the Linux kernel version because AMD Ryzen’s are supported since kernel v. 4.10, while default kernel in openSUSE Leap 42.2 is 4.4.
It can be performed with <a href="https://doc.opensuse.org/documentation/leap/reference/html/book.opensuse.reference/cha.tuning.multikernel.html#cha.tuning.multikernel.zypper">Zypper</a>. Finally, I use Linux kernel 4.13.9 from the <a href="http://download.opensuse.org/repositories/Kernel:/stable/standard/x86_64/">repo</a>. Unfortunately, 4.14 is under development and unstable, so, I did not manage to make it work properly.</p>

<p>After that, it is possible to overclock the setup, if you want. The system has a great overclocking potential. I, personally, achieved 3.8 GHz CPU rate and 2933 MHz RAM clock rate on near to stock voltage. However, it all depends on your ambitions, luck and efficiency of the cooling system. 
<a href="https://www.mersenne.org/download/">Prime95</a> can be used for system stability testing.</p>

<h2 id="install-nvidia">Install Nvidia</h2>

<p>The latest available Nvidia driver can be installed with <a href="https://en.opensuse.org/SDB:NVIDIA_drivers#Recommended_Procedure">Zypper</a>. <a href="https://developer.nvidia.com/cuda-downloads">Cuda 9</a> can be downloaded from the official Nvidia site and installed without any problems as well as <a href="https://developer.nvidia.com/cudnn">cuDNN 7</a>. One may need to add the installation location into the <code class="highlighter-rouge">$LD_LIBRARY_PATH</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LD_LIBRARY_PATH=/usr/local/cuda/lib64:$LD_LIBRARY_PATH
LD_LIBRARY_PATH=/usr/local/cuda/include:$LD_LIBRARY_PATH
LD_LIBRARY_PATH=/usr/local/cuda:$LD_LIBRARY_PATH
export LD_LIBRARY_PATH
</code></pre></div></div>
<p>You may add the lines to your .bashrc file</p>

<h2 id="tensorflow">TensorFlow</h2>

<p>To build Tensorflow from source (as it is the only option to make it runnable with CUDA 9) we need <a href="https://docs.bazel.build/versions/master/install.html">Bazel</a>. It should be compiled from source as well.
However, I was not able to compile it with default java OpenJDK, so, I had to install original <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">Java JDK 8</a>. <code class="highlighter-rouge">/usr/local/</code> is my place to install it. Do not forget to add its location as <code class="highlighter-rouge">$JAVA_HOME</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export JAVA_HOME=/usr/local/jdk
export PATH=$JAVA_HOME/bin:$PATH
</code></pre></div></div>

<p>The Bazel installation <a href="https://docs.bazel.build/versions/master/install-compile-source.html">instruction</a> is quite simple, however, do not forget to install the Bazel dependencies (<code class="highlighter-rouge">zip</code> is the only missed package in case of described here installation of openSUSE 42.2).
After compilation, I placed it in the   <code class="highlighter-rouge">/usr/local/</code> as well and add it to the $PATH.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export PATH=/usr/local/bazel/bin:$PATH
</code></pre></div></div>

<p>Finally, it is possible to compile the <a href="https://www.tensorflow.org/install/install_sources">TensorFlow</a>!</p>

<p>We need a Python 3.5 environment as it is the only version supported by TensorFlow. I prefer to use <a href="https://conda.io/miniconda.html">miniconda</a> virtual environments. So, I installed miniconda3 and created a Python 3.5.4 environment.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda create -n tensorflow python=3.5.4
</code></pre></div></div>

<p>After <code class="highlighter-rouge">source activate tensorflow</code> command you are able to install all TensorFlow dependencies in the virtual environment with <code class="highlighter-rouge">pip install</code>.</p>

<p>Let’s compile the TensorFlow 1.4.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/tensorflow/tensorflow 
cd tensorflow
git checkout r1.4
./configure
</code></pre></div></div>
<p>At this step, you have to specify the path to installed packages and versions you’d like to use. After configure, it can be built and installed.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package
bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg
sudo pip install /tmp/tensorflow_pkg/tensorflow-YOUR-VERSION.whl
</code></pre></div></div>

<p>UPDATE: You may consider building Tensorflow with the processor-specific optimization, such as AVX2 or SSE4.2 instructions. See <a href="https://stackoverflow.com/questions/41293077/how-to-compile-tensorflow-with-sse4-2-and-avx-instructions">How to compile Tensorflow with SSE4.2 and AVX instructions</a>.
It really can increase the system performance for about 10-20% according to my personal experience.</p>

<p>And it is done!</p>

</div>
    <hr />
    <div class="share-page">
    Share this on &rarr;
 <a href="https://twitter.com/share" class="twitter-share-button" data-via="">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Google + -->
<div class="g-plus" data-action="share" data-annotation="bubble"></div>
<script src="https://apis.google.com/js/platform.js" async defer></script>

<!-- Facebook -->
<div class="fb-share-button" data-href="http://localhost:4000/deeplearning/2017/10/20/How-I-run-TensorFlow-with-CUDA-9-and-cuDNN-7-in-openSUSE-on-AMD-Ryzen.html" data-layout="button_count" style="position: relative; top: -8px; left: 3px;"></div>
</div>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.6&appId=";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
</article>
<hr />

<div class="PageNavigation">
  
    <a class="prev pull-left" href="http://localhost:4000/deeplearning/2017/09/21/Neural-network-for-multiclass-image-segmentation.html">&laquo; Neural network for multiclass image segmentation</a>
  
  
    <a class="next pull-right" href="http://localhost:4000/deeplearning/competitions/2018/02/20/Camera-model-identification-with-deep-learning.html">Camera model identification with deep learning &raquo;</a>
  
</div>



    
    
        
            
        
    
        
            
                
                <div class="panel-body">
                <h4>Related Posts</h4>
                <ul>
                
                <li class="relatedPost">
                    <a href="http://localhost:4000/hardware,/deeplearning/2018/11/06/Benchmarking-RTX-2080-Ti-vs-Pascal-GPUs-with-DL-tasks.html">Benchmarking RTX 2080 Ti vs Pascal GPUs vs Tesla V100 with DL tasks</a>
                    
                        <small>(Categories: <a href="/category/Hardware,">Hardware,</a>, <a href="/category/DeepLearning">DeepLearning</a>)</small>
                    
                </li>
                
                
            
        
    

    
    
        
            
                
                <li class="relatedPost">
                    <a href="http://localhost:4000/deeplearning/competitions/2018/10/24/Semantic-Segmentation-of-Seismic-Reflection-Images.html">Semantic Segmentation of Seismic Reflection Images</a>
                    
                        <small>(Categories: <a href="/category/DeepLearning">DeepLearning</a>, <a href="/category/Competitions">Competitions</a>)</small>
                    
                </li>
                
                
            
        
    
        
            
        
    

    
    
        
            
                
                <li class="relatedPost">
                    <a href="http://localhost:4000/deeplearning/competitions/2018/10/23/About-Kaggle-TGS-Salt-Identification-Challenge.html">About Kaggle TGS Salt Identification Challenge</a>
                    
                        <small>(Categories: <a href="/category/DeepLearning">DeepLearning</a>, <a href="/category/Competitions">Competitions</a>)</small>
                    
                </li>
                
                
            
        
    
        
            
        
    

    
    
        
            
                
                <li class="relatedPost">
                    <a href="http://localhost:4000/deeplearning/competitions/2018/06/05/Discussion-of-the-Lyft-Perception-Challenge.html">Discussion of the Lyft Perception Challenge</a>
                    
                        <small>(Categories: <a href="/category/DeepLearning">DeepLearning</a>, <a href="/category/Competitions">Competitions</a>)</small>
                    
                </li>
                
                
            
        
    
        
            
        
    

    
    
        
            
                
                <li class="relatedPost">
                    <a href="http://localhost:4000/deeplearning/competitions/2018/06/05/Multiclass-semantic-segmentation-with-LinkNet34.html">Multiclass semantic segmentation with LinkNet34</a>
                    
                        <small>(Categories: <a href="/category/DeepLearning">DeepLearning</a>, <a href="/category/Competitions">Competitions</a>)</small>
                    
                </li>
                
                
            
        
    
        
            
        
    

    
    
        
            
                
                <li class="relatedPost">
                    <a href="http://localhost:4000/deeplearning/competitions/2018/05/31/About-Lyft-Perception-Challenge.html">About Lyft Perception Challenge</a>
                    
                        <small>(Categories: <a href="/category/DeepLearning">DeepLearning</a>, <a href="/category/Competitions">Competitions</a>)</small>
                    
                </li>
                
                
            
        
    
        
            
        
    

    
    
        
            
        
    
        
            
        
    

    
    
        
            
        
    
        
            
        
    

    
    
        
            
        
    

    
    
        
            
        
    

    
    
        
            
        
    

    
    
        
            
        
    

    
    
        
            
        
    

    
    
        
            
        
    

    
    
        
            
        
    
        
            
        
    


    </ul>
    </div>


          <div class="row">
            <div class="col-md-12 col-xs-12 footer">
              <footer>
  © 2022-2023 Manuel Carita, <a href="/">Home</a> - Powered by Jekyll with <a href="https://github.com/codeasashu/hcz-jekyll-blog">HCZ Material theme</a>.
</footer>
<div align="center">
  <ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-0000000000000000"
    data-ad-slot="0000000000"
    data-ad-format="auto"></ins>
</div>

            </div>
          </div>
        </div> <!-- end /.col-md-9 -->
      </div> <!-- end /.row -->
    </div>

    
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<script src="/static/js/thickbox-compressed.js"></script>
<script src="/static/js/material.min.js"></script>
<script src="/static/js/main.js"></script>
<script src="/static/js/projects.js"></script>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-104440412-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>
