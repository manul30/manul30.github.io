<!DOCTYPE html>
<html>
  <head>
    
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="shortcut icon" href="/static/img/favicon.ico" />
        <title>Discussion of the Lyft Perception Challenge - Computer Vision Lab</title>
        <meta name="author" content="Manuel Carita" />
        <meta name="description" content="Discussion of the Lyft Perception Challenge" />
        <meta name="keywords" content="Discussion of the Lyft Perception Challenge, Computer Vision Lab, DeepLearning, Competitions" />

        <meta content="" property="fb:app_id">
        <meta content="Computer Vision Lab" property="og:site_name">
        
          <meta content="Discussion of the Lyft Perception Challenge" property="og:title">
        
        
          <meta content="article" property="og:type">
        
        
          <meta content="A Robotics, Computer Vision and Machine Learning lab by Manuel Carita. The main focus of the blog is Self-Driving Car Technology and Deep Learning.
" property="og:description">
        
        
          <meta content="http://localhost:4000/deeplearning/competitions/2018/06/05/Discussion-of-the-Lyft-Perception-Challenge.html" property="og:url">
        
        
          <meta content="2018-06-05T04:00:00-05:00" property="article:published_time">
          <meta content="http://localhost:4000/about/" property="article:author">
        
        
          <meta content="http://localhost:4000/static/img/logo-high-resolution.png" property="og:image">
        
        
          
          <meta content="DeepLearning" property="article:section">
          
        
        
          
        
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@">
        <meta name="twitter:creator" content="@">
        
          <meta name="twitter:title" content="Discussion of the Lyft Perception Challenge">
        
        
          <meta name="twitter:url" content="http://localhost:4000/deeplearning/competitions/2018/06/05/Discussion-of-the-Lyft-Perception-Challenge.html">
        
        
          <meta name="twitter:description" content="A Robotics, Computer Vision and Machine Learning lab by Manuel Carita. The main focus of the blog is Self-Driving Car Technology and Deep Learning.
">
        
        

      <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">
      <script type="text/javascript">window.baseurl = 'http://localhost:4000';</script>
      
        <!-- Custom Fonts -->
        <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">

        <!-- FontAwesome icons -->
        <link rel="stylesheet" href="https://use.fontawesome.com/74dfc6cf47.css">

        <!-- Core BootStrap CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <!-- Material Design CSS -->
        <link rel="stylesheet" href="/static/css/bootstrap-material-design.min.css">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/static/css/syntax.css">

        <!-- Custom CSS -->        
        <link rel="stylesheet" href="/static/css/thickbox.css">
        <link rel="stylesheet" href="/static/css/main.css">
        <link rel="stylesheet" href="/static/css/projects.css">

        <script type="text/javascript">
          //loadingImage is relative to project dir
          var tb_pathToImage = "/static/img/loadingAnimation.gif";
        </script>

  </head>

  <body class="home overflow-hidden">
    <div class="header-panel shadow-z-2">
      <div class="container">
        <div class="row">
          <div class="col-md-5 col-sm-5 col-xs-12">
            <div class="row-picture">
              <img id="about" class="logo-img" src="/static/img/logo.png" height="75px" width="75px">
            </div>
            <div class="row-details">
              <h3 class="list-group-item-heading" style="padding-top: 15%;font-size: 32px">Manuel Carita</h3>
              <h5 class="list-group-item-heading">Mechatronics Engineer</h5>
              <div class="social-icons">
	
        <a class="icon" target="_blank" href="https://www.linkedin.com/in/manuelcarita"><i class="fa fa-linkedin"></i></a>
    
        <a class="icon" target="_blank" href="https://github.com/manul30"><i class="fa fa-github"></i></a>
    
</div>

            </div>
            <div class="navbar-header pull-right">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <i class="fa fa-2x fa-bars"></i>
              </button>
            </div>
          </div>
          <div class="col-md-7 col-sm-7 col-xs-12">
          <div class="row">
            <h2 class="blog-title-pro " style="padding-top: 5%;padding-left: 40%;font-size: 24px;">Discussion of the Lyft Perception Challenge</h2>
            
            </div>
            <p class="info">
              
                <span class="time">05 Jun 2018</span>
              
              
                <span class="categories">
                  &raquo; 
                  
                    <a href="/category/DeepLearning">DeepLearning</a>
                    , 
                  
                    <a href="/category/Competitions">Competitions</a>
                    
                  
                </span>
              
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="container main outer">
      <div class="row">
        <div class="col-md-3 col-xs-12">
              <nav class="menu">
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="list-separator nav navbar-nav well well-primary post">

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12 current-menu-item Discussion-of-the-Lyft-Perception-Challenge.html"><a href="/" target="_self"><i class="fa fa-home"></i> Home</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  Discussion-of-the-Lyft-Perception-Challenge.html"><a href="/projects" target="_self"><i class="fa fa-desktop"></i> Projects</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  Discussion-of-the-Lyft-Perception-Challenge.html"><a href="/about" target="_self"><i class="fa fa-user"></i> About me</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  Discussion-of-the-Lyft-Perception-Challenge.html"><a href="/resume" target="_self"><i class="fa fa-graduation-cap"></i> Profile</a></li>

</ul>

    </div>
    </nav>

        </div>
        <div class="col-md-9 col-xs-12 full">
          <div class="post-content well">
<article class="content">
    <div class="post-head">
    <h1><b>Discussion of the Lyft Perception Challenge </b></h1>
    </div>
    <p>June 05, 2018</p>
    <p>

  4 mins read

</p>
    <div class="post"><h2 id="speedup-tricks">Speedup tricks</h2>

<p>The basic prediction script was profiled with <a href="https://pypi.org/project/yappi/">yappi</a> multithreaded python profiler, and the profiling results gave rise to some speed up ideas.</p>

<p>It was observed in the training dataset, that cars and roads could not be situated on arbitrary part of the input image, but only on the central region, while the top part contains the sky and the bottom - the hood. So, the model was trained and predicts only that center part of the image. Original image was 800x600 px, while 800x320 px crops were utilized.</p>

<p>Images with masks should be encoded with png encoding at the final step of the pipeline. The process was parallelized with a <a href="https://pythonhosted.org/joblib/">joblib</a> library. It is an excellent instrument for simple parallel for loops using multiprocessing or multithreading.</p>

<p>To increase the inference rate, one may reduce the amount of data transferred between the GPU and CPU. So, most of the postprocessing was done on a GPU, and only binary masks of desired classes were transferred back from GPU as byte tensors (3x times less volume as compared to original float32 tensor).</p>

<p>The whole pipeline, suggested by the competition organizers, was also optimized. It was experimentally shown that pybase64 library is faster than the standard base64 in base64 encoding. OpenCV is better for fast png encoding that PIL, which was suggested in the demo script. One may also play with the png compression rate, but it was not useful in this case. Predictions were done in a batch manner, so, it helps to utilize the whole GPU and take advantages of big VRAM storage.</p>

<p>A significant amount of time the prediction script spends on the model file loading, python modules import and the model preparation. In order to eliminate this lag, a client-server approach was used. A server should be started in advance and on start, it loads all the necessary things. After the server is ready, a client application can be used. Client application only sends the path to the test video as a http request and receives the predictions from the server as a json.</p>

<p>Each of the tricks helped to improve the FPS a little bit, but the whole program was able to reach &gt;20 FPS rate in the testing workspace and &gt;60 FPS on an ordinary desktop with Nvidia GTX 1080 Ti GPU. One should keep in mind that the timing result includes png and base64 encodings of the model predictions. So, the approach may be applied to real-time semantic segmentation!</p>

<h2 id="examined-ideas">Examined ideas</h2>

<p>Besides the <a href="/deeplearning/competitions/2018/06/05/Multiclass-semantic-segmentation-with-LinkNet34.html">described</a> pipeline, several other approaches were tested, but did not lead to better results:</p>

<ul>
  <li>
    <p>Usage of an extra class “windows”. It was quite challenging for the neural network to correctly label pixels of transparent parts of vehicles. It seemed rather promising to predict the extra class “windows” and exclude the predictions from the “car” class. Unfortunately, the approach forces to use sigmoid as the output layer to allow classes overlap which ultimately led to overall score reduction.</p>
  </li>
  <li>
    <p>Usage of any weights to force the CNN to pay more attention to the “car” class and deal with class imbalance. Usage of BCE element in the loss function also was not a good idea.</p>
  </li>
  <li>
    <p>Application of Gaussian noise augmentation. The simulator produces clear images without any image-capture process related noises. Such kind of augmentation may help for real application but only slows down the training process on the simulated data.</p>
  </li>
  <li>
    <p>Other encoders: ResNet18 was not able to achieve comparable to ResNet34 score, whereas  ResNet50 heavily overfit on the train data.</p>
  </li>
  <li>
    <p>Train separate models for “road” and “car” classes. Since the prediction rate is more than two times higher than required, we can use two models. In fact, it does not work well because the classes start to overlap. One network for both target classes works better, and in this case application of more classes may work as a kind of regularization which forces the network to understand the scene better.</p>
  </li>
</ul>

<h2 id="further-ideas">Further ideas</h2>

<p>Some further ideas for prediction results improvement:</p>

<ul>
  <li>
    <p>The CARLA simulator provides a limited variety of cars and landscapes, so, it is possible to collect more data and virtually “overfit” to all possible scenes.</p>
  </li>
  <li>
    <p>Use more augmentations. One may consider applying some extra augmentations to mimic lens flares and weather conditions.</p>
  </li>
  <li>
    <p>Add some techniques to prevent overfitting: weights regularization, dropout, etc.</p>
  </li>
  <li>
    <p>Find the best encoder architecture, experiment with the decoder blocks, or experiment with other architectures.</p>
  </li>
  <li>
    <p>Use extra input channels with semantic masks from the previous frame. This may make masks predictions more sustainable and smooth between frames, however, it may decrease the neural network prediction speed.</p>
  </li>
</ul>

<h2 id="results">Results</h2>

<iframe width="560" height="315" src="https://www.youtube.com/embed/15vnXdaoo8Q?rel=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen=""></iframe>

<p><img src="/assets/post12/lb.jpg" alt="Leaderoard" /></p>

<p>The project code is available on <a href="https://github.com/NikolasEnt/Lyft-Perception-Challenge">Github</a>.</p>

</div>
    <hr />
    <div class="share-page">
    Share this on &rarr;
 <a href="https://twitter.com/share" class="twitter-share-button" data-via="">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Google + -->
<div class="g-plus" data-action="share" data-annotation="bubble"></div>
<script src="https://apis.google.com/js/platform.js" async defer></script>

<!-- Facebook -->
<div class="fb-share-button" data-href="http://localhost:4000/deeplearning/competitions/2018/06/05/Discussion-of-the-Lyft-Perception-Challenge.html" data-layout="button_count" style="position: relative; top: -8px; left: 3px;"></div>
</div>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.6&appId=";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
</article>
<hr />

<div class="PageNavigation">
  
    <a class="prev pull-left" href="http://localhost:4000/deeplearning/competitions/2018/06/05/Multiclass-semantic-segmentation-with-LinkNet34.html">&laquo; Multiclass semantic segmentation with LinkNet34</a>
  
  
    <a class="next pull-right" href="http://localhost:4000/deeplearning/competitions/2018/10/23/About-Kaggle-TGS-Salt-Identification-Challenge.html">About Kaggle TGS Salt Identification Challenge &raquo;</a>
  
</div>



    
    
        
            
        
            
        
    
        
            
                
                <div class="panel-body">
                <h4>Related Posts</h4>
                <ul>
                
                <li class="relatedPost">
                    <a href="http://localhost:4000/hardware,/deeplearning/2018/11/06/Benchmarking-RTX-2080-Ti-vs-Pascal-GPUs-with-DL-tasks.html">Benchmarking RTX 2080 Ti vs Pascal GPUs vs Tesla V100 with DL tasks</a>
                    
                        <small>(Categories: <a href="/category/Hardware,">Hardware,</a>, <a href="/category/DeepLearning">DeepLearning</a>)</small>
                    
                </li>
                
                
            
        
            
        
    

    
    
        
            
                
                <li class="relatedPost">
                    <a href="http://localhost:4000/deeplearning/competitions/2018/10/24/Semantic-Segmentation-of-Seismic-Reflection-Images.html">Semantic Segmentation of Seismic Reflection Images</a>
                    
                        <small>(Categories: <a href="/category/DeepLearning">DeepLearning</a>, <a href="/category/Competitions">Competitions</a>)</small>
                    
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
                
                <li class="relatedPost">
                    <a href="http://localhost:4000/deeplearning/competitions/2018/10/23/About-Kaggle-TGS-Salt-Identification-Challenge.html">About Kaggle TGS Salt Identification Challenge</a>
                    
                        <small>(Categories: <a href="/category/DeepLearning">DeepLearning</a>, <a href="/category/Competitions">Competitions</a>)</small>
                    
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
                
                <li class="relatedPost">
                    <a href="http://localhost:4000/deeplearning/competitions/2018/06/05/Multiclass-semantic-segmentation-with-LinkNet34.html">Multiclass semantic segmentation with LinkNet34</a>
                    
                        <small>(Categories: <a href="/category/DeepLearning">DeepLearning</a>, <a href="/category/Competitions">Competitions</a>)</small>
                    
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
                
                <li class="relatedPost">
                    <a href="http://localhost:4000/deeplearning/competitions/2018/05/31/About-Lyft-Perception-Challenge.html">About Lyft Perception Challenge</a>
                    
                        <small>(Categories: <a href="/category/DeepLearning">DeepLearning</a>, <a href="/category/Competitions">Competitions</a>)</small>
                    
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
                
                <li class="relatedPost">
                    <a href="http://localhost:4000/deeplearning/competitions/2018/02/21/An-approach-to-predicted-class-balancing.html">An approach to predicted class balancing</a>
                    
                        <small>(Categories: <a href="/category/DeepLearning">DeepLearning</a>, <a href="/category/Competitions">Competitions</a>)</small>
                    
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    


    </ul>
    </div>


          <div class="row">
            <div class="col-md-12 col-xs-12 footer">
              <footer>
  © 2022-2023 Manuel Carita, <a href="/">Home</a> - Powered by Jekyll with <a href="https://github.com/codeasashu/hcz-jekyll-blog">HCZ Material theme</a>.
</footer>
<div align="center">
  <ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-0000000000000000"
    data-ad-slot="0000000000"
    data-ad-format="auto"></ins>
</div>

            </div>
          </div>
        </div> <!-- end /.col-md-9 -->
      </div> <!-- end /.row -->
    </div>

    
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<script src="/static/js/thickbox-compressed.js"></script>
<script src="/static/js/material.min.js"></script>
<script src="/static/js/main.js"></script>
<script src="/static/js/projects.js"></script>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-104440412-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>
