<!DOCTYPE html>
<html>
  <head>
    
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="shortcut icon" href="/static/img/favicon.ico" />
        <title>An approach to predicted class balancing - Computer Vision Lab</title>
        <meta name="author" content="Manuel Carita" />
        <meta name="description" content="An approach to predicted class balancing" />
        <meta name="keywords" content="An approach to predicted class balancing, Computer Vision Lab, DeepLearning, Competitions" />

        <meta content="" property="fb:app_id">
        <meta content="Computer Vision Lab" property="og:site_name">
        
          <meta content="An approach to predicted class balancing" property="og:title">
        
        
          <meta content="article" property="og:type">
        
        
          <meta content="A Robotics, Computer Vision and Machine Learning lab by Manuel Carita. The main focus of the blog is Self-Driving Car Technology and Deep Learning.
" property="og:description">
        
        
          <meta content="http://localhost:4000/deeplearning/competitions/2018/02/21/An-approach-to-predicted-class-balancing.html" property="og:url">
        
        
          <meta content="2018-02-21T04:00:00-05:00" property="article:published_time">
          <meta content="http://localhost:4000/about/" property="article:author">
        
        
          <meta content="http://localhost:4000/static/img/logo-high-resolution.png" property="og:image">
        
        
          
          <meta content="DeepLearning" property="article:section">
          
        
        
          
        
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@">
        <meta name="twitter:creator" content="@">
        
          <meta name="twitter:title" content="An approach to predicted class balancing">
        
        
          <meta name="twitter:url" content="http://localhost:4000/deeplearning/competitions/2018/02/21/An-approach-to-predicted-class-balancing.html">
        
        
          <meta name="twitter:description" content="A Robotics, Computer Vision and Machine Learning lab by Manuel Carita. The main focus of the blog is Self-Driving Car Technology and Deep Learning.
">
        
        

      <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">
      <script type="text/javascript">window.baseurl = 'http://localhost:4000';</script>
      
        <!-- Custom Fonts -->
        <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">

        <!-- FontAwesome icons -->
        <link rel="stylesheet" href="https://use.fontawesome.com/74dfc6cf47.css">

        <!-- Core BootStrap CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <!-- Material Design CSS -->
        <link rel="stylesheet" href="/static/css/bootstrap-material-design.min.css">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/static/css/syntax.css">

        <!-- Custom CSS -->        
        <link rel="stylesheet" href="/static/css/thickbox.css">
        <link rel="stylesheet" href="/static/css/main.css">
        <link rel="stylesheet" href="/static/css/projects.css">

        <script type="text/javascript">
          //loadingImage is relative to project dir
          var tb_pathToImage = "/static/img/loadingAnimation.gif";
        </script>

  </head>

  <body class="home overflow-hidden">
    <div class="header-panel shadow-z-2">
      <div class="container">
        <div class="row">
          <div class="col-md-5 col-sm-5 col-xs-12">
            <div class="row-picture">
              <img id="about" class="logo-img" src="/static/img/logo.png" height="75px" width="75px">
            </div>
            <div class="row-details">
              <h3 class="list-group-item-heading" style="padding-top: 15%;font-size: 32px">Manuel Carita</h3>
              <h5 class="list-group-item-heading">Mechatronics Engineer</h5>
              <div class="social-icons">
	
        <a class="icon" target="_blank" href="https://www.linkedin.com/in/manuelcarita"><i class="fa fa-linkedin"></i></a>
    
        <a class="icon" target="_blank" href="https://github.com/manul30"><i class="fa fa-github"></i></a>
    
</div>

            </div>
            <div class="navbar-header pull-right">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <i class="fa fa-2x fa-bars"></i>
              </button>
            </div>
          </div>
          <div class="col-md-7 col-sm-7 col-xs-12">
          <div class="row">
            <h2 class="blog-title-pro " style="padding-top: 5%;padding-left: 40%;font-size: 24px;">An approach to predicted class balancing</h2>
            
            </div>
            <p class="info">
              
                <span class="time">21 Feb 2018</span>
              
              
                <span class="categories">
                  &raquo; 
                  
                    <a href="/category/DeepLearning">DeepLearning</a>
                    , 
                  
                    <a href="/category/Competitions">Competitions</a>
                    
                  
                </span>
              
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="container main outer">
      <div class="row">
        <div class="col-md-3 col-xs-12">
              <nav class="menu">
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="list-separator nav navbar-nav well well-primary post">

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12 current-menu-item An-approach-to-predicted-class-balancing.html"><a href="/" target="_self"><i class="fa fa-home"></i> Home</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  An-approach-to-predicted-class-balancing.html"><a href="/projects" target="_self"><i class="fa fa-desktop"></i> Projects</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  An-approach-to-predicted-class-balancing.html"><a href="/about" target="_self"><i class="fa fa-user"></i> About me</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  An-approach-to-predicted-class-balancing.html"><a href="/resume" target="_self"><i class="fa fa-graduation-cap"></i> Profile</a></li>

</ul>

    </div>
    </nav>

        </div>
        <div class="col-md-9 col-xs-12 full">
          <div class="post-content well">
<article class="content">
    <div class="post-head">
    <h1><b>An approach to predicted class balancing </b></h1>
    </div>
    <p>February 21, 2018</p>
    <p>

  8 mins read

</p>
    <div class="post"><h2 id="postprocessing-of-predictions">Postprocessing of predictions</h2>

<p>It was observed that the predicted class distribution in the <a href="/proj/comp1/">Kaggle: IEEE’s Signal Processing Society - Camera Model Identification Challenge</a> is near to equal (see the <a href="/deeplearning/competitions/2018/02/20/Camera-model-identification-with-deep-learning.html">post</a> for details on the challenge). Hence, one may assume that there is equal number of images from each class. The altered images were considered as separate classes.
So, there are 20 classes for images assignment and, given 2640 test samples, one may expect 132 images in each class.</p>

<p>Given the assumption, predictions were balanced.</p>

<p>We have predictions, which could be represented as a pandas dataset like so:</p>

<table border="1" class="dataframe">  <thead>    <tr style="text-align: right;">      <th></th>      <th>frame</th>      <th>HTC-1-M7</th>      <th>iPhone-6</th>      <th>...</th>      <th>Motorola-Nexus-6</th>      <th>Samsung-Galaxy-Note3</th>      <th>Sony-NEX-7</th>    </tr>  </thead>  <tbody>    <tr>      <th>0</th>      <td>img_0002a04_manip.tif</td>      <td>5.083291e-04</td>      <td>1.730842e-03</td>      <td>...</td>      <td>6.565361e-02</td>      <td>7.312844e-04</td>      <td>5.617269e-04</td>    </tr>    <tr>      <th>1</th>      <td>img_001e31c_unalt.tif</td>      <td>1.333470e-03</td>      <td>1.378153e-03</td>      <td>...</td>      <td>1.011069e-03</td>      <td>1.311640e-04</td>      <td>5.842330e-04</td>    </tr>    <tr>      <th>...</th>      <td>...</td>      <td>...</td>      <td>...</td>      <td>...</td>      <td>...</td>      <td>...</td>      <td>...</td>    </tr>    <tr>      <th>2638</th>      <td>img_ff56ac2_unalt.tif</td>      <td>1.707251e-04</td>      <td>2.834913e-04</td>      <td>...</td>      <td>4.762203e-04</td>      <td>8.150683e-05</td>      <td>9.958064e-01</td>    </tr>    <tr>      <th>2639</th>      <td>img_ffaeda7_unalt.tif</td>      <td>6.653962e-11</td>      <td>3.320259e-11</td>      <td>...</td>      <td>4.800383e-11</td>      <td>8.671302e-12</td>      <td>4.138669e-13</td>    </tr>  </tbody></table>

<p>A sample .csv file with predicted probabilities is available <a href="/assets/post9/sample_predictions.csv">here</a>.</p>

<p>A two-stage algorithm was introduced for class balancing:</p>
<ol>
  <li>For each class, one by one, sort samples by predicted probability and examine them in descending order. Assign samples while there are free slots for the desired class and the predicted probability is higher than the given threshold. The threshold was selected to be 0.5. It means that images with one predicted class probability higher than the value could not have any other class with higher probability. Exclude assigned samples from further consideration.</li>
  <li>Find the highest probability in the remaining subset and try to assign a sample with it to the corresponding class. If the class already has enough samples, set the examined probability to zero. Exclude the sample from further consideration in case of successful class assignment.</li>
</ol>

<p>The following function implements the proposed algorithm and it can be applied to manipulated and unaltered images separately:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="k">def</span> <span class="nf">class_balancer</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">n_per_cl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names_list</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Images per class
</span>    <span class="n">names</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># A dict with the results
</span>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nam</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>  <span class="c1"># For each class
</span>        <span class="n">res</span><span class="p">[</span><span class="n">nam</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="n">nam</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span> <span class="o">&gt;</span> <span class="n">THRES</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">nam</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">n_per_cl</span><span class="p">:</span>
            <span class="c1"># If the prediction is confident enought and we have slots
</span>            <span class="c1"># in the class, add the sample to it
</span>            <span class="n">res</span><span class="p">[</span><span class="n">nam</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># While we have any images for classses filling
</span>        <span class="n">df_l</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">!=</span> <span class="s">'frame'</span><span class="p">]</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="nb">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>  <span class="c1"># A sample with the max probability in the remaining set
</span>        <span class="n">nam</span> <span class="o">=</span> <span class="n">df_l</span><span class="o">.</span><span class="nb">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>  <span class="c1"># Class of the max probability
</span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">nam</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">n_per_cl</span><span class="p">:</span>
            <span class="c1"># If it is posseble to fill the most probable class
</span>            <span class="n">res</span><span class="p">[</span><span class="n">nam</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">row</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Set probobility to 0
</span>            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">nam</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="n">res</span></pre></td></tr></tbody></table></code></pre></figure>

<p>The function was used along with the following code for data reading, blending predictions by mean square, preparing pandas dataframes for unaltered and manipulated images, processing, and generation of the final submission file.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">os</span>

<span class="n">THRES</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># Minimal probaility to consider as a confident prediction
</span><span class="n">results_path</span> <span class="o">=</span> <span class="s">'./results/'</span>  <span class="c1"># Path to the directory with results in .csv format
</span><span class="n">names_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">'frame'</span><span class="p">,</span> <span class="s">'HTC-1-M7'</span><span class="p">,</span> <span class="s">'iPhone-6'</span><span class="p">,</span> <span class="s">'Motorola-Droid-Maxx'</span><span class="p">,</span> <span class="s">'Motorola-X'</span><span class="p">,</span>
              <span class="s">'Samsung-Galaxy-S4'</span><span class="p">,</span> <span class="s">'iPhone-4s'</span><span class="p">,</span> <span class="s">'LG-Nexus-5x'</span><span class="p">,</span> <span class="s">'Motorola-Nexus-6'</span><span class="p">,</span>
              <span class="s">'Samsung-Galaxy-Note3'</span><span class="p">,</span> <span class="s">'Sony-NEX-7'</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">make_sub</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dic</span><span class="p">):</span>  <span class="c1"># Make a file for submission
</span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">'fname,camera</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">[</span><span class="n">r</span><span class="p">]:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="s">','</span><span class="o">+</span><span class="n">r</span><span class="o">+</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>

<span class="c1"># Read all files with predictions in the results_path directory
</span><span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># A list of dataframes with predicted probabilities
</span><span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">results_path</span><span class="p">):</span>
    <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names_list</span><span class="p">))</span>

<span class="c1"># Blending by mean square
</span><span class="n">df_fin</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dfs</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">df_fin</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">df_fin</span> <span class="o">=</span> <span class="n">df</span>
        <span class="n">df_fin</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">df_fin</span><span class="o">.</span><span class="n">columns</span> <span class="o">!=</span> <span class="s">'frame'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_fin</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">df_fin</span><span class="o">.</span><span class="n">columns</span> <span class="o">!=</span> <span class="s">'frame'</span><span class="p">]</span><span class="o">.</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">!=</span> <span class="s">'frame'</span><span class="p">]</span><span class="o">.</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">df2</span><span class="p">[</span><span class="s">'frame'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'frame'</span><span class="p">]</span>
        <span class="n">df_fin</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">df_fin</span><span class="o">.</span><span class="n">columns</span> <span class="o">!=</span> <span class="s">'frame'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">df2</span><span class="o">.</span><span class="n">columns</span> <span class="o">!=</span> <span class="s">'frame'</span><span class="p">]</span>\
                                                   <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">df_fin</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">df_fin</span><span class="o">.</span><span class="n">columns</span> <span class="o">!=</span> <span class="s">'frame'</span><span class="p">])</span>
<span class="n">df_fin</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">df_fin</span><span class="o">.</span><span class="n">columns</span> <span class="o">!=</span> <span class="s">'frame'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df_fin</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">df_fin</span><span class="o">.</span><span class="n">columns</span> <span class="o">!=</span> <span class="s">'frame'</span><span class="p">])</span>

<span class="n">df_manip</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="nb">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s">"_manip"</span><span class="p">)</span><span class="o">==</span><span class="bp">True</span><span class="p">]</span>
<span class="n">df_unalt</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="nb">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s">"_unalt"</span><span class="p">)</span><span class="o">==</span><span class="bp">True</span><span class="p">]</span>

<span class="n">res_manip</span> <span class="o">=</span> <span class="n">class_balancer</span><span class="p">(</span><span class="n">df_manip</span><span class="p">)</span>
<span class="n">res_unalt</span> <span class="o">=</span> <span class="n">class_balancer</span><span class="p">(</span><span class="n">df_unalt</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">res_unalt</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>  <span class="c1"># Append res_unalt to res_manip
</span>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">res_unalt</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
        <span class="n">res_manip</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

<span class="n">make_sub</span><span class="p">(</span><span class="s">"results.csv"</span><span class="p">,</span> <span class="n">res_manip</span><span class="p">)</span></pre></td></tr></tbody></table></code></pre></figure>

<p><em>It is the real competition code, written in the last two hours of the competition. Sorry, pep8 :)</em></p>

<p>An increase of accuracy on the leaderboard by ~1.2-1.6% was observed as the result of this approach application, which makes a huge difference in the final standing.</p>

</div>
    <hr />
    <div class="share-page">
    Share this on &rarr;
 <a href="https://twitter.com/share" class="twitter-share-button" data-via="">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Google + -->
<div class="g-plus" data-action="share" data-annotation="bubble"></div>
<script src="https://apis.google.com/js/platform.js" async defer></script>

<!-- Facebook -->
<div class="fb-share-button" data-href="http://localhost:4000/deeplearning/competitions/2018/02/21/An-approach-to-predicted-class-balancing.html" data-layout="button_count" style="position: relative; top: -8px; left: 3px;"></div>
</div>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.6&appId=";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
</article>
<hr />

<div class="PageNavigation">
  
    <a class="prev pull-left" href="http://localhost:4000/deeplearning/competitions/2018/02/20/Camera-model-identification-with-deep-learning.html">&laquo; Camera model identification with deep learning</a>
  
  
    <a class="next pull-right" href="http://localhost:4000/deeplearning/competitions/2018/05/31/About-Lyft-Perception-Challenge.html">About Lyft Perception Challenge &raquo;</a>
  
</div>



    
    
        
            
        
            
        
    
        
            
                
                <div class="panel-body">
                <h4>Related Posts</h4>
                <ul>
                
                <li class="relatedPost">
                    <a href="http://localhost:4000/hardware,/deeplearning/2018/11/06/Benchmarking-RTX-2080-Ti-vs-Pascal-GPUs-with-DL-tasks.html">Benchmarking RTX 2080 Ti vs Pascal GPUs vs Tesla V100 with DL tasks</a>
                    
                        <small>(Categories: <a href="/category/Hardware,">Hardware,</a>, <a href="/category/DeepLearning">DeepLearning</a>)</small>
                    
                </li>
                
                
            
        
            
        
    

    
    
        
            
                
                <li class="relatedPost">
                    <a href="http://localhost:4000/deeplearning/competitions/2018/10/24/Semantic-Segmentation-of-Seismic-Reflection-Images.html">Semantic Segmentation of Seismic Reflection Images</a>
                    
                        <small>(Categories: <a href="/category/DeepLearning">DeepLearning</a>, <a href="/category/Competitions">Competitions</a>)</small>
                    
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
                
                <li class="relatedPost">
                    <a href="http://localhost:4000/deeplearning/competitions/2018/10/23/About-Kaggle-TGS-Salt-Identification-Challenge.html">About Kaggle TGS Salt Identification Challenge</a>
                    
                        <small>(Categories: <a href="/category/DeepLearning">DeepLearning</a>, <a href="/category/Competitions">Competitions</a>)</small>
                    
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
                
                <li class="relatedPost">
                    <a href="http://localhost:4000/deeplearning/competitions/2018/06/05/Discussion-of-the-Lyft-Perception-Challenge.html">Discussion of the Lyft Perception Challenge</a>
                    
                        <small>(Categories: <a href="/category/DeepLearning">DeepLearning</a>, <a href="/category/Competitions">Competitions</a>)</small>
                    
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
                
                <li class="relatedPost">
                    <a href="http://localhost:4000/deeplearning/competitions/2018/06/05/Multiclass-semantic-segmentation-with-LinkNet34.html">Multiclass semantic segmentation with LinkNet34</a>
                    
                        <small>(Categories: <a href="/category/DeepLearning">DeepLearning</a>, <a href="/category/Competitions">Competitions</a>)</small>
                    
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
                
                <li class="relatedPost">
                    <a href="http://localhost:4000/deeplearning/competitions/2018/05/31/About-Lyft-Perception-Challenge.html">About Lyft Perception Challenge</a>
                    
                        <small>(Categories: <a href="/category/DeepLearning">DeepLearning</a>, <a href="/category/Competitions">Competitions</a>)</small>
                    
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    


    </ul>
    </div>


          <div class="row">
            <div class="col-md-12 col-xs-12 footer">
              <footer>
  © 2022-2023 Manuel Carita, <a href="/">Home</a> - Powered by Jekyll with <a href="https://github.com/codeasashu/hcz-jekyll-blog">HCZ Material theme</a>.
</footer>
<div align="center">
  <ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-0000000000000000"
    data-ad-slot="0000000000"
    data-ad-format="auto"></ins>
</div>

            </div>
          </div>
        </div> <!-- end /.col-md-9 -->
      </div> <!-- end /.row -->
    </div>

    
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<script src="/static/js/thickbox-compressed.js"></script>
<script src="/static/js/material.min.js"></script>
<script src="/static/js/main.js"></script>
<script src="/static/js/projects.js"></script>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-104440412-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>
