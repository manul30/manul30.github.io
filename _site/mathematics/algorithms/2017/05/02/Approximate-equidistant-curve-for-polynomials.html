<!DOCTYPE html>
<html>
  <head>
    
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="shortcut icon" href="/static/img/favicon.ico" />
        <title>Approximate equidistant curve for polynomials - Computer Vision Lab</title>
        <meta name="author" content="Manuel Carita" />
        <meta name="description" content="Approximate equidistant curve for polynomials" />
        <meta name="keywords" content="Approximate equidistant curve for polynomials, Computer Vision Lab, Mathematics, Algorithms" />

        <meta content="" property="fb:app_id">
        <meta content="Computer Vision Lab" property="og:site_name">
        
          <meta content="Approximate equidistant curve for polynomials" property="og:title">
        
        
          <meta content="article" property="og:type">
        
        
          <meta content="A Robotics, Computer Vision and Machine Learning lab by Manuel Carita. The main focus of the blog is Self-Driving Car Technology and Deep Learning.
" property="og:description">
        
        
          <meta content="http://localhost:4000/mathematics/algorithms/2017/05/02/Approximate-equidistant-curve-for-polynomials.html" property="og:url">
        
        
          <meta content="2017-05-02T04:43:27-05:00" property="article:published_time">
          <meta content="http://localhost:4000/about/" property="article:author">
        
        
          <meta content="http://localhost:4000/static/img/logo-high-resolution.png" property="og:image">
        
        
          
          <meta content="Mathematics" property="article:section">
          
        
        
          
        
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@">
        <meta name="twitter:creator" content="@">
        
          <meta name="twitter:title" content="Approximate equidistant curve for polynomials">
        
        
          <meta name="twitter:url" content="http://localhost:4000/mathematics/algorithms/2017/05/02/Approximate-equidistant-curve-for-polynomials.html">
        
        
          <meta name="twitter:description" content="A Robotics, Computer Vision and Machine Learning lab by Manuel Carita. The main focus of the blog is Self-Driving Car Technology and Deep Learning.
">
        
        

      <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">
      <script type="text/javascript">window.baseurl = 'http://localhost:4000';</script>
      
        <!-- Custom Fonts -->
        <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">

        <!-- FontAwesome icons -->
        <link rel="stylesheet" href="https://use.fontawesome.com/74dfc6cf47.css">

        <!-- Core BootStrap CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <!-- Material Design CSS -->
        <link rel="stylesheet" href="/static/css/bootstrap-material-design.min.css">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/static/css/syntax.css">

        <!-- Custom CSS -->        
        <link rel="stylesheet" href="/static/css/thickbox.css">
        <link rel="stylesheet" href="/static/css/main.css">
        <link rel="stylesheet" href="/static/css/projects.css">

        <script type="text/javascript">
          //loadingImage is relative to project dir
          var tb_pathToImage = "/static/img/loadingAnimation.gif";
        </script>

  </head>

  <body class="home overflow-hidden">
    <div class="header-panel shadow-z-2">
      <div class="container">
        <div class="row">
          <div class="col-md-5 col-sm-5 col-xs-12">
            <div class="row-picture">
              <img id="about" class="logo-img" src="/static/img/logo.png" height="75px" width="75px">
            </div>
            <div class="row-details">
              <h3 class="list-group-item-heading" style="padding-top: 15%;font-size: 32px">Manuel Carita</h3>
              <h5 class="list-group-item-heading">Mechatronics Engineer</h5>
              <div class="social-icons">
	
        <a class="icon" target="_blank" href="https://www.linkedin.com/in/manuelcarita"><i class="fa fa-linkedin"></i></a>
    
        <a class="icon" target="_blank" href="https://github.com/manul30"><i class="fa fa-github"></i></a>
    
</div>

            </div>
            <div class="navbar-header pull-right">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <i class="fa fa-2x fa-bars"></i>
              </button>
            </div>
          </div>
          <div class="col-md-7 col-sm-7 col-xs-12">
          <div class="row">
            <h2 class="blog-title-pro " style="padding-top: 5%;padding-left: 40%;font-size: 24px;">Approximate equidistant curve for polynomials</h2>
            
            </div>
            <p class="info">
              
                <span class="time">02 May 2017</span>
              
              
                <span class="categories">
                  &raquo; 
                  
                    <a href="/category/Mathematics">Mathematics</a>
                    , 
                  
                    <a href="/category/Algorithms">Algorithms</a>
                    
                  
                </span>
              
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="container main outer">
      <div class="row">
        <div class="col-md-3 col-xs-12">
              <nav class="menu">
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="list-separator nav navbar-nav well well-primary post">

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12 current-menu-item Approximate-equidistant-curve-for-polynomials.html"><a href="/" target="_self"><i class="fa fa-home"></i> Home</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  Approximate-equidistant-curve-for-polynomials.html"><a href="/projects" target="_self"><i class="fa fa-desktop"></i> Projects</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  Approximate-equidistant-curve-for-polynomials.html"><a href="/about" target="_self"><i class="fa fa-user"></i> About me</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  Approximate-equidistant-curve-for-polynomials.html"><a href="/resume" target="_self"><i class="fa fa-graduation-cap"></i> Profile</a></li>

</ul>

    </div>
    </nav>

        </div>
        <div class="col-md-9 col-xs-12 full">
          <div class="post-content well">
<article class="content">
    <div class="post-head">
    <h1><b>Approximate equidistant curve for polynomials </b></h1>
    </div>
    <p>May 02, 2017</p>
    <p>

  12 mins read

</p>
    <div class="post"><h2 id="introduction">Introduction</h2>

<p>It is required to have an equidistant curve for a given polynomial for a great variety of applications. For example, an equidistant is needed for a lane detection visual system of a <em>Self-Driving car</em> in case only one line is well determined (the other one is the equidistant because lane lines are parallel). There is an exact <a href="http://www.mathpages.com/home/kmath724/kmath724.html">solution</a> for the problem and it is known that an equidistant for a polynomial function is a higher order polynomial function.</p>

<p>However, it is usually needed to have an equidistant polynomial of the same order to the given one. For instance, it is essential for the mentioned above application to make the visual system robust and stable. Therefore, an approximate method  was developed.</p>

<p><strong>Task:</strong> Given the reference polynomial coefficients <code class="highlighter-rouge">pol</code> and desired distance <code class="highlighter-rouge">d</code> defined perpendicular to the given line, find approximate equidistant line as polynomial of the same degree and return its coefficients <code class="highlighter-rouge">pol_eq</code>.</p>

<h2 id="ideas">Ideas</h2>

<ul>
  <li>
    <p>Create a set of <code class="highlighter-rouge">N</code> points  with the same orthogonal distance (<code class="highlighter-rouge">d</code>)from a given polynomial.</p>
  </li>
  <li>
    <p>Fit a new polynomial of desired degree to the point set.</p>
  </li>
</ul>

<p>The following simple expressions are useful for the calculations:</p>

<p>Equation of a straight line:</p>

<h4 id="y--k--x--b"><em>y = k * x + b;</em></h4>

<p>It is needed to flip the reference slope and change its sign to find a perpendicular slope:</p>

<h4 id="km---1--k"><em>k<sub>m</sub> = -1 / k;</em></h4>

<h2 id="implementation">Implementation</h2>

<p>The implementation will use Python with Numpy and Matplotlib library for results visualisation.</p>

<p>First of all, points correspond to the given polynomial should be calculated. X coordinates of reference points initialized as equally spaced points between <code class="highlighter-rouge">0</code> and <code class="highlighter-rouge">max_l</code>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># Calculate a polinomial value in a given point x
</span><span class="k">def</span> <span class="nf">pol_calc</span><span class="p">(</span><span class="n">pol</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">pol_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">pol_f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="n">EQUID_POINTS</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># N
# pol - given polinimial coefficients (e.q. pol = np.array([-1.0, 2.5]))
</span><span class="n">x_pol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_l</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">EQUID_POINTS</span><span class="p">)</span>
<span class="n">y_pol</span> <span class="o">=</span> <span class="n">pol_calc</span><span class="p">(</span><span class="n">pol</span><span class="p">,</span> <span class="n">x_pol</span><span class="p">)</span></code></pre></figure>

<p>In order to make things simpler with bounds points and better define the slope coefficients we will consider points in between to neighbour pairs of generated ones. They can be obtained by linear interpolation.</p>

<p>Here we calculate coordinates of such points and direction of perpendiculars as slopes of perpendicular lines (<code class="highlighter-rouge">k_m</code> calculated as <em>k<sub>m</sub> = -1 / k</em>)which start from the middle points:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># Calculate polints position between given points
</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_pol</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">y_m</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">y_pol</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y_pol</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span><span class="o">+</span><span class="n">y_pol</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">x_m</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x_pol</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x_pol</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span><span class="o">+</span><span class="n">x_pol</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="c1"># Slope of perpendicular lines
</span>    <span class="k">if</span> <span class="n">y_pol</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">y_pol</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="c1">#Avoid division by 0
</span>        <span class="n">k_m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1e8</span><span class="p">)</span> <span class="c1"># A vary big number
</span>    <span class="k">else</span><span class="p">:</span>
        <span class="n">k_m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x_pol</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x_pol</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">y_pol</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y_pol</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="c1"># Slope of perpendicular lines</span></code></pre></figure>

<p>Shifts <code class="highlighter-rouge">dx</code> and <code class="highlighter-rouge">dy</code> of the equidistant points (<code class="highlighter-rouge">x_eq</code> and <code class="highlighter-rouge">y_eq</code>) from the middle reference points (<code class="highlighter-rouge">x_m</code> and <code class="highlighter-rouge">y_m</code>) should be calculated. In fact, <code class="highlighter-rouge">dx = x_eq - x_m</code> and <code class="highlighter-rouge">dy = y_eq - y_m</code>.</p>

<p>Taking into account the Pythagorean theorem:</p>

<h4 id="dx2--dy2--d2"><em>dx<sup>2</sup> + dy<sup>2</sup> = d<sup>2</sup>;</em></h4>

<p>And k<sub>m</sub> definition:</p>

<h4 id="km--dy--dx"><em>k<sub>m</sub> = dy / dx;</em></h4>

<p>One can found out <code class="highlighter-rouge">dx</code> and <code class="highlighter-rouge">dy</code>:</p>

<h4 id="dx--d11km205"><em>dx = d(1/(1+k<sub>m</sub><sup>2</sup>))<sup>0.5</sup>;</em></h4>
<h4 id="dy--km--dx"><em>dy = k<sub>m</sub> * dx;</em></h4>
<p>Here the calculations implemented with respect to desired position (sign of <code class="highlighter-rouge">d</code>) of the equidistant and the reference points positions.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1">#Calculate equidistant points
</span><span class="n">x_eq</span> <span class="o">=</span> <span class="n">d</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">k_m</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># Calculate reference shift of the equidistant points
</span><span class="n">y_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x_eq</span><span class="p">)</span> <span class="c1"># Create np.array for y_eq
</span><span class="k">if</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># x positions of the equidistant depends on direction
</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_m</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">k_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> 
            <span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">y_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">k_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x_m</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="n">k_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_m</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">k_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">y_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">k_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x_m</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="n">k_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></code></pre></figure>

<p>The final step is to fit a new polynomial of desired degree to the point set</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">pol_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x_eq</span><span class="p">,</span> <span class="n">y_eq</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span></code></pre></figure>

<h2 id="results-and-discussion">Results and discussion</h2>
<p>As a result, the algorithm is able to produce reasonably well defined equidistant in a simple linear case:</p>

<p><img src="/assets/post1/equid0.jpg" alt="Image 1" /></p>

<p>As well as in case of higher order polynomial:</p>

<p><img src="/assets/post1/equid1.jpg" alt="Image 2" /></p>

<p>However, in case of real application, one should keep in mind two notes:</p>

<ul>
  <li>Equidistant is not always a smooth function because of geometrical restrains:</li>
</ul>

<p><img src="/assets/post1/equid2.jpg" alt="Image 3" /></p>

<ul>
  <li>The algorithm use the same <code class="highlighter-rouge">x</code> coordinates of points for reference points set and for building approximation. That is why it is forced to “predict” the reference line behavior in an extended interval. It can lead to unexpected results, especially in case of high order polynomial:</li>
</ul>

<p><img src="/assets/post1/equid3.jpg" alt="Image 4" /></p>

<p>The last issue can be addressed by wise extending <code class="highlighter-rouge">x</code> range of the reference points set.</p>
<h2 id="the-code">The code</h2>
<p>Final code of the project with visualisation.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c1"># Calculate a polinomial value in a given point x
</span><span class="k">def</span> <span class="nf">pol_calc</span><span class="p">(</span><span class="n">pol</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">pol_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">pol_f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="c1"># Create original line text equation for a plot legend
</span><span class="k">def</span> <span class="nf">text_eq</span><span class="p">(</span><span class="n">pol</span><span class="p">):</span>
    <span class="n">str_eq</span> <span class="o">=</span> <span class="s">'Original line</span><span class="se">\n</span><span class="s">y = '</span> 
    <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pol</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">str_eq</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">order</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span><span class="o">-</span><span class="n">j</span>
        <span class="k">if</span> <span class="n">order</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">str_eq</span> <span class="o">+=</span> <span class="p">(</span><span class="s">'x^'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">order</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">pol</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">str_eq</span> <span class="o">+=</span> <span class="s">'+'</span>
        <span class="k">elif</span> <span class="n">order</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">str_eq</span> <span class="o">+=</span> <span class="p">(</span><span class="s">'x'</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pol</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">str_eq</span> <span class="o">+=</span> <span class="s">'+'</span>
        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">str_eq</span>

<span class="c1">#Calculate approximated equidistant to a parabola
</span><span class="n">EQUID_POINTS</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># Number of points to use for the equidistant approximation
</span>
<span class="k">def</span> <span class="nf">equidistant</span><span class="p">(</span><span class="n">pol</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">max_l</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="n">x_pol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_l</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">EQUID_POINTS</span><span class="p">)</span> <span class="c1"># Reference curve points
</span>    <span class="n">y_pol</span> <span class="o">=</span> <span class="n">pol_calc</span><span class="p">(</span><span class="n">pol</span><span class="p">,</span> <span class="n">x_pol</span><span class="p">)</span>
    <span class="n">x_m</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Mid points
</span>    <span class="n">y_m</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">k_m</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Calculate polints position between given points
</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_pol</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">y_m</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">y_pol</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y_pol</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span><span class="o">+</span><span class="n">y_pol</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">x_m</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x_pol</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x_pol</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span><span class="o">+</span><span class="n">x_pol</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c1"># Slope of perpendicular lines
</span>        <span class="k">if</span> <span class="n">y_pol</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">y_pol</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="c1">#Avoid division by 0
</span>            <span class="n">k_m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1e8</span><span class="p">)</span> <span class="c1"># A vary big number
</span>        <span class="k">else</span><span class="p">:</span>
            <span class="n">k_m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x_pol</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x_pol</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">y_pol</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y_pol</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="c1"># Slope of a perpendicular
</span>    <span class="c1"># Convert arrays into np.arrays
</span>    <span class="n">x_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_m</span><span class="p">)</span>
    <span class="n">y_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_m</span><span class="p">)</span>
    <span class="n">k_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k_m</span><span class="p">)</span>
    <span class="c1"># Calculate equidistant points
</span>    <span class="n">x_eq</span> <span class="o">=</span> <span class="n">d</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">k_m</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># Calculate reference shift dx of the equidistant points
</span>    <span class="n">y_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x_eq</span><span class="p">)</span> <span class="c1"># Create np.array for y_eq
</span>    <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># x positions of the equidistant depends on direction
</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_m</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">k_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> 
                <span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">y_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">k_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x_m</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="n">k_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_m</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">k_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">y_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">k_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x_m</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="n">k_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="c1"># Fit a polinomial of order which is the same to the given one to the equidistant points 
</span>    <span class="n">pol_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x_eq</span><span class="p">,</span> <span class="n">y_eq</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Visualize results
</span>    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="c1"># Original line
</span>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_pol</span><span class="p">,</span> <span class="n">y_pol</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'red'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">text_eq</span><span class="p">(</span><span class="n">pol</span><span class="p">))</span> 
        <span class="c1"># Equidistant
</span>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_eq</span><span class="p">,</span> <span class="n">y_eq</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'green'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'Equidistant, d = '</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
        <span class="c1">#Approximation
</span>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_pol</span><span class="p">,</span> <span class="n">pol_calc</span><span class="p">(</span><span class="n">pol_eq</span><span class="p">,</span> <span class="n">x_pol</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s">'blue'</span><span class="p">,</span>
                 <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'Approximation'</span><span class="p">)</span> 
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span> <span class="c1"># Add legend
</span>        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'equal'</span><span class="p">)</span>
        <span class="c1"># Draw black connection lines
</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_m</span><span class="p">)):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x_m</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="p">[</span><span class="n">y_m</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">y_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="c1">#plt.savefig('./equid.jpg')
</span>    <span class="k">return</span> <span class="n">pol_eq</span>

<span class="c1"># Use example
</span><span class="n">pol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">,</span>  <span class="o">-</span><span class="mf">2.5</span><span class="p">,</span>  <span class="mf">0.2</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">equidistant</span><span class="p">(</span><span class="n">pol</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span></code></pre></figure>

<p>The code was used in the Lane Lines Detection <a href="/proj/proj1">project</a>.</p>

</div>
    <hr />
    <div class="share-page">
    Share this on &rarr;
 <a href="https://twitter.com/share" class="twitter-share-button" data-via="">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Google + -->
<div class="g-plus" data-action="share" data-annotation="bubble"></div>
<script src="https://apis.google.com/js/platform.js" async defer></script>

<!-- Facebook -->
<div class="fb-share-button" data-href="http://localhost:4000/mathematics/algorithms/2017/05/02/Approximate-equidistant-curve-for-polynomials.html" data-layout="button_count" style="position: relative; top: -8px; left: 3px;"></div>
</div>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.6&appId=";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
</article>
<hr />

<div class="PageNavigation">
  
  
    <a class="next pull-right" href="http://localhost:4000/opencv/2017/05/05/Camera-calibration-with-OpenCV.html">Camera calibration with OpenCV &raquo;</a>
  
</div>



    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    



          <div class="row">
            <div class="col-md-12 col-xs-12 footer">
              <footer>
  © 2022-2023 Manuel Carita, <a href="/">Home</a> - Powered by Jekyll with <a href="https://github.com/codeasashu/hcz-jekyll-blog">HCZ Material theme</a>.
</footer>
<div align="center">
  <ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-0000000000000000"
    data-ad-slot="0000000000"
    data-ad-format="auto"></ins>
</div>

            </div>
          </div>
        </div> <!-- end /.col-md-9 -->
      </div> <!-- end /.row -->
    </div>

    
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<script src="/static/js/thickbox-compressed.js"></script>
<script src="/static/js/material.min.js"></script>
<script src="/static/js/main.js"></script>
<script src="/static/js/projects.js"></script>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-104440412-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>
